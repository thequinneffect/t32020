#!/usr/bin/python3
# COMP3311 20T3 Ass3 ... print name, year, ratings of top N movies

import sys
import psycopg2

# globals and queries

usage = "Usage: best [N]"
db = None
get_best = """
select m.rating, m.title, m.start_year
from movies m 
order by m.rating desc, m.title asc
limit %s
"""

# process command-line args

n = 10
argc = len(sys.argv)
if (argc > 1): # if user specified a number, use it
  if (sys.argv[1].isdigit() and int(sys.argv[1]) > 0):
    n = int(sys.argv[1])
  else:
    print(usage)
    exit(0)

# manipulate database

try:
  db = psycopg2.connect("dbname=imdb")
  cur = db.cursor()

  cur.execute(get_best, [n])
  for row in cur.fetchall():
    rating, title, year = row
    print(f"{rating} {title} ({year})")
    
except psycopg2.Error as err:
  print("DB error: ", err)
finally:
  if db:
    db.close()

